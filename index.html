<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carteira Zoom - Análise de Investimentos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 56px;
        }
        
        .sidebar {
            background-color: var(--primary-color);
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
            z-index: 1000;
            transition: all 0.3s;
            width: 250px;
        }
        
        .sidebar a {
            color: var(--light-color);
            padding: 15px 20px;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
        }
        
        .sidebar a:hover {
            background-color: var-secondary-color;
        }
        
        .sidebar a.active {
            background-color: var(--accent-color);
            font-weight: bold;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }
        
        .table th {
            background-color: var(--light-color);
        }
        
        .positive-return {
            color: var(--success-color);
        }
        
        .negative-return {
            color: var(--danger-color);
        }
        
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        
        .stats-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stats-label {
            font-size: 14px;
            color: #6c757d;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
            margin: 20px 0;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .editable-cell {
            position: relative;
        }
        
        .editable-cell input {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .edit-buttons {
            display: flex;
            gap: 5px;
        }
        
        .cotacao-atual {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .loading-cotacao {
            color: #6c757d;
            font-style: italic;
        }
        
        .queda-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .queda-faixa1 {
            background-color: #ffeeba;
            color: #856404;
        }
        
        .queda-faixa2 {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .queda-faixa3 {
            background-color: #d4edda;
            color: #155724;
        }
        
        .alta-faixa1 {
            background-color: #d4edda;
            color: #155724;
        }
        
        .alta-faixa2 {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .alta-faixa3 {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .logo-container {
            text-align: center;
            padding: 15px 10px;
            margin-bottom: 20px;
        }
        
        .logo-container img {
            max-width: 180px;
            height: auto;
            filter: brightness(0) invert(1);
        }
        
        .mobile-header {
            display: none;
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .mobile-header .logo-container {
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .mobile-header .logo-container img {
            max-width: 150px;
            filter: brightness(0) invert(1);
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .ativo-item {
            cursor: move;
        }
        
        .submenu {
            padding-left: 30px;
            font-size: 0.9em;
        }
        
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .view-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .view-option-btn {
            padding: 6px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-option-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
                height: 100%;
                overflow-y: auto;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-header {
                display: block;
            }
            
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.5);
                z-index: 999;
            }
            
            .overlay.active {
                display: block;
            }
        }
        
        @media (max-width: 576px) {
            .card-body {
                padding: 15px;
            }
            
            .table-responsive {
                font-size: 14px;
            }
            
            .stats-value {
                font-size: 20px;
            }
            
            .btn-group-sm > .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- Header para mobile -->
    <div class="mobile-header">
        <div class="logo-container">
            <button class="menu-toggle" id="menuToggle">
                <i class="bi bi-list"></i>
            </button>
            <img src="https://github.com/catskilltrader/App-CarteiraZoom/blob/main/Logo%201%20-%20Carteira%20Zoom%20(Sem%20fundo).png?raw=true" alt="Carteira Zoom">
            <div style="width: 48px;"></div>
        </div>
    </div>
    
    <!-- Overlay para mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Barra lateral -->
    <div class="sidebar" id="sidebar">
        <div class="logo-container d-none d-md-block">
            <img src="https://github.com/catskilltrader/App-CarteiraZoom/blob/main/Logo%201%20-%20Carteira%20Zoom%20(Sem%20fundo).png?raw=true" alt="Carteira Zoom">
        </div>
        <a href="#" class="nav-link active" data-section="dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
        <a href="#" class="nav-link" data-section="carteira"><i class="bi bi-table me-2"></i> Carteira</a>
        <a href="#" class="nav-link" data-section="performance"><i class="bi bi-graph-up me-2"></i> Performance</a>
        <a href="#" class="nav-link" data-section="dividendos"><i class="bi bi-cash-coin me-2"></i> Dividendos</a>
        <a href="#" class="nav-link" data-section="relatorios-estudos"><i class="bi bi-clipboard-data me-2"></i> Relatórios & Estudos</a>
    </div>

    <!-- Conteúdo principal -->
    <div class="main-content" id="mainContent">
        <!-- Seção Dashboard -->
        <div id="dashboard" class="content-section active">
            <h2 class="section-title">Dashboard de Renda Variável</h2>
            
            <!-- Cards de estatísticas -->
            <div class="row">
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value positive-return">18,7%</div>
                            <div class="stats-label">Retorno Anual</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value">1.28</div>
                            <div class="stats-label">Índice Sharpe</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value">14,2%</div>
                            <div class="stats-label">Volatilidade</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value positive-return">R$ 2.450</div>
                            <div class="stats-label">Dividendos/Mês</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico e tabela -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Performance da Carteira vs. Benchmarks</span>
                            <div class="view-options">
                                <button class="view-option-btn active" data-period="1y">1 Ano</button>
                                <button class="view-option-btn" data-period="5y">5 Anos</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Alocação por Setor
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="sectorChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela de ativos -->
            <div class="card mt-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Carteira de Ativos</span>
                    <div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary">Filtrar</button>
                            <button class="btn btn-sm btn-outline-secondary">Ordenar</button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Ativo</th>
                                    <th>Setor</th>
                                    <th>Preço (R$)</th>
                                    <th>P/VPA</th>
                                    <th>Div. Yield</th>
                                    <th>Retorno 12M</th>
                                    <th>Retorno Ano</th>
                                    <th>Sharpe</th>
                                    <th>Volatilidade</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>PETR4</td>
                                    <td>Energia</td>
                                    <td>32.67</td>
                                    <td>1.24</td>
                                    <td>8.2%</td>
                                    <td class="positive-return">+24.7%</td>
                                    <td class="positive-return">+15.3%</td>
                                    <td>1.42</td>
                                    <td>22.1%</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>VALE3</td>
                                    <td>Mineração</td>
                                    <td>68.91</td>
                                    <td>1.32</td>
                                    <td>6.7%</td>
                                    <td class="positive-return">+18.3%</td>
                                    <td class="positive-return">+12.8%</td>
                                    <td>1.28</td>
                                    <td>20.4%</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>SLCE3</td>
                                    <td>Agropecuário</td>
                                    <td>45.20</td>
                                    <td>1.15</td>
                                    <td>4.5%</td>
                                    <td class="positive-return">+12.5%</td>
                                    <td class="positive-return">+8.2%</td>
                                    <td>1.10</td>
                                    <td>18.7%</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>BBAS3</td>
                                    <td>Financeiro</td>
                                    <td>35.40</td>
                                    <td>0.92</td>
                                    <td>5.8%</td>
                                    <td class="positive-return">+12.4%</td>
                                    <td class="positive-return">+8.9%</td>
                                    <td>1.15</td>
                                    <td>18.3%</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>CPFE3</td>
                                    <td>Energia</td>
                                    <td>32.15</td>
                                    <td>1.08</td>
                                    <td>6.2%</td>
                                    <td class="positive-return">+9.8%</td>
                                    <td class="positive-return">+7.3%</td>
                                    <td>0.95</td>
                                    <td>16.5%</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Detalhes</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Abas para dividendos e detalhes -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#">Histórico de Dividendos</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Projeção</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="dividendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            Detalhes do Ativo Selecionado
                        </div>
                        <div class="card-body">
                            <h5>PETR4 - Petrobras</h5>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <p><strong>Setor:</strong> Energia</p>
                                    <p><strong>Cotacao:</strong> R$ 32.67</p>
                                    <p><strong>P/VPA:</strong> 1.24</p>
                                    <p><strong>DY:</strong> 8.2%</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Retorno 12M:</strong> <span class="positive-return">+24.7%</span></p>
                                    <p><strong>Retorno Ano:</strong> <span class="positive-return">+15.3%</span></p>
                                    <p><strong>Sharpe:</strong> 1.42</p>
                                    <p><strong>Volatilidade:</strong> 22.1%</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-primary">Ver Histórico Completo</button>
                                <button class="btn btn-sm btn-outline-secondary ms-2">Comparar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção Carteira -->
        <div id="carteira" class="content-section">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="section-title">Minha Carteira</h2>
                <div>
                    <button class="btn btn-primary" id="btn-adicionar-ativo">
                        <i class="bi bi-plus-circle"></i> Adicionar Ativo
                    </button>
                    <button class="btn btn-outline-secondary ms-2" id="btn-reordenar">
                        <i class="bi bi-arrow-down-up"></i> Reordenar
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            Composição da Carteira
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="carteiraChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Resumo da Carteira (5 anos)
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <p class="mb-1">Valor Total Investido</p>
                                <h4 class="positive-return">R$ <span id="total-investido">183.245,60</span></h4>
                            </div>
                            <div class="mb-3">
                                <p class="mb-1">Valor Atual</p>
                                <h4 class="positive-return">R$ <span id="valor-atual">216.502,40</span></h4>
                            </div>
                            <div class="mb-3">
                                <p class="mb-1">Lucro/Prejuízo</p>
                                <h4 class="positive-return" id="lucro-prejuizo">+ R$ 33.256,80 (+18,2%)</h4>
                            </div>
                            <div class="mb-3">
                                <p class="mb-1">Total em Dividendos</p>
                                <h4 class="positive-return">R$ <span id="total-dividendos">12.845,30</span></h4>
                            </div>
                            <div class="mb-3">
                                <p class="mb-1">Retorno Total 5 anos</p>
                                <h4 class="positive-return">+89,4%</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Detalhamento dos Ativos</span>
                    <div>
                        <!-- Botão Exportar removido conforme solicitado -->
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="tabela-ativos">
                            <thead>
                                <tr>
                                    <th width="5%"></th>
                                    <th>Ativo</th>
                                    <th>Quantidade</th>
                                    <th>Cotacao Atual</th>
                                    <th>Total Investido</th>
                                    <th>Valor Atual</th>
                                    <th>% Carteira</th>
                                    <th>Retorno 5Y</th>
                                    <th>Resultado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-ativo="PETR4" data-quantidade="800" class="ativo-item">
                                    <td><i class="bi bi-grip-vertical"></i></td>
                                    <td class="editable-cell">
                                        <span class="view-mode">PETR4</span>
                                        <input type="text" class="edit-mode form-control form-control-sm" value="PETR4" style="display: none;">
                                    </td>
                                    <td class="editable-cell">
                                        <span class="view-mode">800</span>
                                        <input type="number" class="edit-mode form-control form-control-sm" value="800" style="display: none;">
                                    </td>
                                    <td class="cotacao-atual" data-ticket="PETR4">R$ 32,67</td>
                                    <td>R$ 21.080,00</td>
                                    <td>R$ 26.136,00</td>
                                    <td>12,1%</td>
                                    <td class="positive-return">+124,7%</td>
                                    <td class="positive-return">+24,0%</td>
                                    <td>
                                        <div class="btn-group btn-group-sm view-mode">
                                            <button class="btn btn-outline-primary btn-editar">Editar</button>
                                            <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                                        </div>
                                        <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                                            <button class="btn btn-outline-success btn-salvar">Salvar</button>
                                            <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-ativo="VALE3" data-quantidade="450" class="ativo-item">
                                    <td><i class="bi bi-grip-vertical"></i></td>
                                    <td class="editable-cell">
                                        <span class="view-mode">VALE3</span>
                                        <input type="text" class="edit-mode form-control form-control-sm" value="VALE3" style="display: none;">
                                    </td>
                                    <td class="editable-cell">
                                        <span class="view-mode">450</span>
                                        <input type="number" class="edit-mode form-control form-control-sm" value="450" style="display: none;">
                                    </td>
                                    <td class="cotacao-atual" data-ticket="VALE3">R$ 68,91</td>
                                    <td>R$ 26.190,00</td>
                                    <td>R$ 31.009,50</td>
                                    <td>14,3%</td>
                                    <td class="positive-return">+98,3%</td>
                                    <td class="positive-return">+18,4%</td>
                                    <td>
                                        <div class="btn-group btn-group-sm view-mode">
                                            <button class="btn btn-outline-primary btn-editar">Editar</button>
                                            <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                                        </div>
                                        <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                                            <button class="btn btn-outline-success btn-salvar">Salvar</button>
                                            <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-ativo="BBAS3" data-quantidade="600" class="ativo-item">
                                    <td><i class="bi bi-grip-vertical"></i></td>
                                    <td class="editable-cell">
                                        <span class="view-mode">BBAS3</span>
                                        <input type="text" class="edit-mode form-control form-control-sm" value="BBAS3" style="display: none;">
                                    </td>
                                    <td class="editable-cell">
                                        <span class="view-mode">600</span>
                                        <input type="number" class="edit-mode form-control form-control-sm" value="600" style="display: none;">
                                    </td>
                                    <td class="cotacao-atual" data-ticket="BBAS3">R$ 35,40</td>
                                    <td>R$ 18.240,00</td>
                                    <td>R$ 21.240,00</td>
                                    <td>9,8%</td>
                                    <td class="positive-return">+72,4%</td>
                                    <td class="positive-return">+16,4%</td>
                                    <td>
                                        <div class="btn-group btn-group-sm view-mode">
                                            <button class="btn btn-outline-primary btn-editar">Editar</button>
                                            <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                                        </div>
                                        <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                                            <button class="btn btn-outline-success btn-salvar">Salvar</button>
                                            <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-ativo="SLCE3" data-quantidade="350" class="ativo-item">
                                    <td><i class="bi bi-grip-vertical"></i></td>
                                    <td class="editable-cell">
                                        <span class="view-mode">SLCE3</span>
                                        <input type="text" class="edit-mode form-control form-control-sm" value="SLCE3" style="display: none;">
                                    </td>
                                    <td class="editable-cell">
                                        <span class="view-mode">350</span>
                                        <input type="number" class="edit-mode form-control form-control-sm" value="350" style="display: none;">
                                    </td>
                                    <td class="cotacao-atual" data-ticket="SLCE3">R$ 45,20</td>
                                    <td>R$ 14.770,00</td>
                                    <td>R$ 15.820,00</td>
                                    <td>7,3%</td>
                                    <td class="positive-return">+72,5%</td>
                                    <td class="positive-return">+7,1%</td>
                                    <td>
                                        <div class="btn-group btn-group-sm view-mode">
                                            <button class="btn btn-outline-primary btn-editar">Editar</button>
                                            <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                                        </div>
                                        <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                                            <button class="btn btn-outline-success btn-salvar">Salvar</button>
                                            <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-ativo="CPFE3" data-quantidade="1200" class="ativo-item">
                                    <td><i class="bi bi-grip-vertical"></i></td>
                                    <td class="editable-cell">
                                        <span class="view-mode">CPFE3</span>
                                        <input type="text" class="edit-mode form-control form-control-sm" value="CPFE3" style="display: none;">
                                    </td>
                                    <td class="editable-cell">
                                        <span class="view-mode">1.200</span>
                                        <input type="number" class="edit-mode form-control form-control-sm" value="1200" style="display: none;">
                                    </td>
                                    <td class="cotacao-atual" data-ticket="CPFE3">R$ 32,15</td>
                                    <td>R$ 36.180,00</td>
                                    <td>R$ 38.580,00</td>
                                    <td>17,8%</td>
                                    <td class="positive-return">+59,8%</td>
                                    <td class="positive-return">+6,6%</td>
                                    <td>
                                        <div class="btn-group btn-group-sm view-mode">
                                            <button class="btn btn-outline-primary btn-editar">Editar</button>
                                            <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                                        </div>
                                        <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                                            <button class="btn btn-outline-success btn-salvar">Salvar</button>
                                            <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="table-primary">
                                    <td colspan="4"><strong>TOTAL</strong></td>
                                    <td><strong>R$ 116.460,00</strong></td>
                                    <td><strong>R$ 132.785,50</strong></td>
                                    <td><strong>100%</strong></td>
                                    <td><strong>+89,4%</strong></td>
                                    <td><strong>+14,0%</strong></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção Performance -->
        <div id="performance" class="content-section">
            <h2 class="section-title">Análise de Performance</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            Retorno por Período
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="returnPeriodChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            Comparativo de Volatilidade
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="volatilityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    Métricas de Performance
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Ativo</th>
                                    <th>Retorno Tot. 5a</th>
                                    <th>DY Tot. 5a</th>
                                    <th>Med. Ret. A.a</th>
                                    <th>Med. DY a.a</th>
                                    <th>Soma Ret. + DY 5a</th>
                                    <th>Med. Ret. Tot. a.a</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>PETR4</td>
                                    <td class="positive-return">124,7%</td>
                                    <td class="positive-return">41,2%</td>
                                    <td class="positive-return">24,9%</td>
                                    <td class="positive-return">8,2%</td>
                                    <td class="positive-return">165,9%</td>
                                    <td class="positive-return">33,2%</td>
                                </tr>
                                <tr>
                                    <td>VALE3</td>
                                    <td class="positive-return">98,3%</td>
                                    <td class="positive-return">33,7%</td>
                                    <td class="positive-return">19,7%</td>
                                    <td class="positive-return">6,7%</td>
                                    <td class="positive-return">132,0%</td>
                                    <td class="positive-return">26,4%</td>
                                </tr>
                                <tr>
                                    <td>SLCE3</td>
                                    <td class="positive-return">72,5%</td>
                                    <td class="positive-return">22,5%</td>
                                    <td class="positive-return">14,5%</td>
                                    <td class="positive-return">4,5%</td>
                                    <td class="positive-return">95,0%</td>
                                    <td class="positive-return">19,0%</td>
                                </tr>
                                <tr>
                                    <td>BBAS3</td>
                                    <td class="positive-return">72,4%</td>
                                    <td class="positive-return">29,0%</td>
                                    <td class="positive-return">14,5%</td>
                                    <td class="positive-return">5,8%</td>
                                    <td class="positive-return">101,4%</td>
                                    <td class="positive-return">20,3%</td>
                                </tr>
                                <tr>
                                    <td>CPFE3</td>
                                    <td class="positive-return">59,8%</td>
                                    <td class="positive-return">31,0%</td>
                                    <td class="positive-return">12,0%</td>
                                    <td class="positive-return">6,2%</td>
                                    <td class="positive-return">90,8%</td>
                                    <td class="positive-return">18,2%</td>
                                </tr>
                                <tr>
                                    <td>CPLE6</td>
                                    <td class="positive-return">52,5%</td>
                                    <td class="positive-return">26,5%</td>
                                    <td class="positive-return">10,5%</td>
                                    <td class="positive-return">5,3%</td>
                                    <td class="positive-return">79,0%</td>
                                    <td class="positive-return">15,8%</td>
                                </tr>
                                <tr>
                                    <td>CMIG4</td>
                                    <td class="positive-return">49,7%</td>
                                    <td class="positive-return">24,0%</td>
                                    <td class="positive-return">9,9%</td>
                                    <td class="positive-return">4,8%</td>
                                    <td class="positive-return">73,7%</td>
                                    <td class="positive-return">14,7%</td>
                                </tr>
                                <tr>
                                    <td>CSMG3</td>
                                    <td class="positive-return">46,8%</td>
                                    <td class="positive-return">21,0%</td>
                                    <td class="positive-return">9,4%</td>
                                    <td class="positive-return">4,2%</td>
                                    <td class="positive-return">67,8%</td>
                                    <td class="positive-return">13,6%</td>
                                </tr>
                                <tr>
                                    <td>TAEE11</td>
                                    <td class="positive-return">61,2%</td>
                                    <td class="positive-return">28,0%</td>
                                    <td class="positive-return">12,2%</td>
                                    <td class="positive-return">5,6%</td>
                                    <td class="positive-return">89,2%</td>
                                    <td class="positive-return">17,8%</td>
                                </tr>
                                <tr>
                                    <td>CXSE3</td>
                                    <td class="positive-return">67,5%</td>
                                    <td class="positive-return">19,5%</td>
                                    <td class="positive-return">13,5%</td>
                                    <td class="positive-return">3,9%</td>
                                    <td class="positive-return">87,0%</td>
                                    <td class="positive-return">17,4%</td>
                                </tr>
                                <tr>
                                    <td>PSSA3</td>
                                    <td class="positive-return">73,2%</td>
                                    <td class="positive-return">26,0%</td>
                                    <td class="positive-return">14,6%</td>
                                    <td class="positive-return">5,2%</td>
                                    <td class="positive-return">99,2%</td>
                                    <td class="positive-return">19,8%</td>
                                </tr>
                                <tr>
                                    <td>GOAU4</td>
                                    <td class="positive-return">58,2%</td>
                                    <td class="positive-return">26,5%</td>
                                    <td class="positive-return">11,6%</td>
                                    <td class="positive-return">5,3%</td>
                                    <td class="positive-return">84,7%</td>
                                    <td class="positive-return">16,9%</td>
                                </tr>
                                <tr>
                                    <td>LEVE3</td>
                                    <td class="positive-return">51,1%</td>
                                    <td class="positive-return">23,5%</td>
                                    <td class="positive-return">10,2%</td>
                                    <td class="positive-return">4,7%</td>
                                    <td class="positive-return">74,6%</td>
                                    <td class="positive-return">14,9%</td>
                                </tr>
                                <tr>
                                    <td>EMBR3</td>
                                    <td class="positive-return">84,8%</td>
                                    <td class="positive-return">19,0%</td>
                                    <td class="positive-return">17,0%</td>
                                    <td class="positive-return">3,8%</td>
                                    <td class="positive-return">103,8%</td>
                                    <td class="positive-return">20,8%</td>
                                </tr>
                                <tr>
                                    <td>DIRR3</td>
                                    <td class="positive-return">47,3%</td>
                                    <td class="positive-return">21,5%</td>
                                    <td class="positive-return">9,5%</td>
                                    <td class="positive-return">4,3%</td>
                                    <td class="positive-return">68,8%</td>
                                    <td class="positive-return">13,8%</td>
                                </tr>
                                <tr>
                                    <td>WEGE3</td>
                                    <td class="negative-return">-15,5%</td>
                                    <td class="positive-return">10,5%</td>
                                    <td class="negative-return">-3,1%</td>
                                    <td class="positive-return">2,1%</td>
                                    <td class="negative-return">-5,0%</td>
                                    <td class="negative-return">-1,0%</td>
                                </tr>
                                <tr>
                                    <td>FRAS3</td>
                                    <td class="positive-return">45,5%</td>
                                    <td class="positive-return">20,0%</td>
                                    <td class="positive-return">9,1%</td>
                                    <td class="positive-return">4,0%</td>
                                    <td class="positive-return">65,5%</td>
                                    <td class="positive-return">13,1%</td>
                                </tr>
                                <tr>
                                    <td>MRFG3</td>
                                    <td class="positive-return">53,7%</td>
                                    <td class="positive-return">23,5%</td>
                                    <td class="positive-return">10,7%</td>
                                    <td class="positive-return">4,7%</td>
                                    <td class="positive-return">77,2%</td>
                                    <td class="positive-return">15,4%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção Dividendos -->
        <div id="dividendos" class="content-section">
            <h2 class="section-title">Análise de Dividendos</h2>
            
            <div class="row mb-4">
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value positive-return">R$ 12.845</div>
                            <div class="stats-label">Dividendos Recebidos</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value">5.2%</div>
                            <div class="stats-label">Dividend Yield Médio</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value">R$ 1.070</div>
                            <div class="stats-label">Média Mensal</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="card">
                        <div class="stats-card">
                            <div class="stats-value positive-return">+8.3%</div>
                            <div class="stats-label">Crescimento Anual</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Projeção de Dividendos
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="projecaoDividendosChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    Histórico de Dividendos por Ativo
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Ativo</th>
                                    <th>Dividend Yield</th>
                                    <th>Último Rendimento</th>
                                    <th>Data do Último</th>
                                    <th>Total Recebido (12M)</th>
                                    <th>Projeção Anual</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>PETR4</td>
                                    <td>8.2%</td>
                                    <td>R$ 2,15</td>
                                    <td>15/09/2023</td>
                                    <td>R$ 1.720,00</td>
                                    <td>R$ 2.140,00</td>
                                </tr>
                                <tr>
                                    <td>VALE3</td>
                                    <td>6.7%</td>
                                    <td>R$ 3,82</td>
                                    <td>20/08/2023</td>
                                    <td>R$ 1.719,00</td>
                                    <td>R$ 2.080,50</td>
                                </tr>
                                <tr>
                                    <td>SLCE3</td>
                                    <td>4.5%</td>
                                    <td>R$ 1,85</td>
                                    <td>10/09/2023</td>
                                    <td>R$ 647,50</td>
                                    <td>R$ 711,00</td>
                                </tr>
                                <tr>
                                    <td>BBAS3</td>
                                    <td>5.8%</td>
                                    <td>R$ 1,45</td>
                                    <td>05/09/2023</td>
                                    <td>R$ 870,00</td>
                                    <td>R$ 1.200,00</td>
                                </tr>
                                <tr>
                                    <td>CPFE3</td>
                                    <td>6.2%</td>
                                    <td>R$ 1,92</td>
                                    <td>18/08/2023</td>
                                    <td>R$ 2.304,00</td>
                                    <td>R$ 2.392,00</td>
                                </tr>
                                <tr>
                                    <td>CPLE6</td>
                                    <td>5.3%</td>
                                    <td>R$ 0,36</td>
                                    <td>12/09/2023</td>
                                    <td>R$ 432,00</td>
                                    <td>R$ 458,00</td>
                                </tr>
                                <tr>
                                    <td>CMIG4</td>
                                    <td>4.8%</td>
                                    <td>R$ 0,50</td>
                                    <td>22/08/2023</td>
                                    <td>R$ 600,00</td>
                                    <td>R$ 624,00</td>
                                </tr>
                                <tr>
                                    <td>CSMG3</td>
                                    <td>4.2%</td>
                                    <td>R$ 0,27</td>
                                    <td>08/09/2023</td>
                                    <td>R$ 324,00</td>
                                    <td>R$ 340,00</td>
                                </tr>
                                <tr>
                                    <td>TAEE11</td>
                                    <td>5.6%</td>
                                    <td>R$ 1,98</td>
                                    <td>15/08/2023</td>
                                    <td>R$ 2.376,00</td>
                                    <td>R$ 2.448,00</td>
                                </tr>
                                <tr>
                                    <td>CXSE3</td>
                                    <td>3.9%</td>
                                    <td>R$ 0,38</td>
                                    <td>25/08/2023</td>
                                    <td>R$ 456,00</td>
                                    <td>R$ 475,00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção Relatórios & Estudos -->
        <div id="relatorios-estudos" class="content-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="section-title">Relatórios & Estudos</h2>
                <div class="btn-group">
                    <button class="btn btn-outline-primary active" data-estudo="queda">Estudos de Queda</button>
                    <button class="btn btn-outline-primary" data-estudo="benchmark">Benchmarks</button>
                </div>
            </div>
            
            <!-- Conteúdo de Estudos de Queda -->
            <div id="conteudo-queda" class="estudo-conteudo">
                <h3 class="mb-4">Estudos de Queda - PETR4</h3>
                
                <div class="row mb-4">
                    <div class="col-md-4 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">-24%</div>
                                <div class="stats-label">Queda Média</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">30 dias</div>
                                <div class="stats-label">Tempo Médio de Queda</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">47 dias</div>
                                <div class="stats-label">Tempo Médio de Recuperação</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Conteúdo de Benchmarks -->
            <div id="conteudo-benchmark" class="estudo-conteudo" style="display: none;">
                <h3 class="mb-4">Benchmarks de Mercado</h3>
                
                <div class="row mb-4">
                    <div class="col-md-3 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">8,49%</div>
                                <div class="stats-label">CDI Médio a.a</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">5,85%</div>
                                <div class="stats-label">IPCA Médio a.a</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">2,00%</div>
                                <div class="stats-label">IBOV Médio a.a</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="card">
                            <div class="stats-card">
                                <div class="stats-value">2,64%</div>
                                <div class="stats-label">Ganho Real CDI</div>
                            </
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Registrar o plugin de datalabels
        Chart.register(ChartDataLabels);
        
        // Configuração da navegação
        document.addEventListener('DOMContentLoaded', function() {
            // Adiciona event listeners para os links de navegação
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove a classe active de todos os links
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    
                    // Adiciona a classe active ao link clicado
                    this.classList.add('active');
                    
                    // Oculta todas as seções de conteúdo
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Exibe a seção correspondente ao link clicado
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Fecha o menu no mobile após clicar em um item
                    if (window.innerWidth < 992) {
                        toggleSidebar();
                    }
                });
            });

            // Configuração do menu mobile
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const mainContent = document.getElementById('mainContent');
            
            menuToggle.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);
            
            function toggleSidebar() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
                
                if (sidebar.classList.contains('active')) {
                    menuToggle.innerHTML = '<i class="bi bi-x-lg"></i>';
                } else {
                    menuToggle.innerHTML = '<i class="bi bi-list"></i>';
                }
            }

            // Configuração dos botões de visualização de período
            document.querySelectorAll('.view-option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    
                    // Remove a classe active de todos os botões
                    document.querySelectorAll('.view-option-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Adiciona a classe active ao botão clicado
                    this.classList.add('active');
                    
                    // Atualiza o gráfico conforme o período selecionado
                    updatePerformanceChart(period);
                });
            });

            // Configuração dos botões de estudo
            document.querySelectorAll('[data-estudo]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const estudo = this.getAttribute('data-estudo');
                    
                    // Remove a classe active de todos os botões
                    document.querySelectorAll('[data-estudo]').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Adiciona a classe active ao botão clicado
                    this.classList.add('active');
                    
                    // Oculta todos os conteúdos de estudo
                    document.querySelectorAll('.estudo-conteudo').forEach(conteudo => {
                        conteudo.style.display = 'none';
                    });
                    
                    // Exibe o conteúdo correspondente
                    document.getElementById(`conteudo-${estudo}`).style.display = 'block';
                });
            });

            // Inicializar gráficos
            initCharts();

            // Buscar cotações automaticamente
            buscarCotacoes();

            // Configurar eventos de edição
            configurarEventosEdicao();

            // Configurar evento do botão adicionar ativo
            document.getElementById('btn-adicionar-ativo').addEventListener('click', adicionarNovoAtivo);

            // Configurar evento do botão reordenar
            document.getElementById('btn-reordenar').addEventListener('click', toggleModoReordenar);
        });

        // Função para inicializar os gráficos
        function initCharts() {
            // Gráfico de Performance vs Benchmarks (1 ano)
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            window.performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: getPerformanceData('1y'),
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolução da Carteira vs Benchmarks',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        },
                        legend: {
                            position: 'bottom',
                        },
                        datalabels: {
                            display: true,
                            align: 'top',
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: '#333',
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Retorno Acumulado (%)'
                            }
                        }
                    }
                }
            });

            // Gráfico de setores com porcentagens
            const sectorCtx = document.getElementById('sectorChart').getContext('2d');
            window.sectorChart = new Chart(sectorCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Financeiro', 'Energia', 'Industrial', 'Mineração', 'Varejo', 'Outros'],
                    datasets: [{
                        data: [35, 25, 15, 12, 8, 5],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12',
                            '#9b59b6',
                            '#34495e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + '%';
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 12
                            }
                        }
                    }
                }
            });

            // Gráfico de dividendos
            const dividendCtx = document.getElementById('dividendChart').getContext('2d');
            window.dividendChart = new Chart(dividendCtx, {
                type: 'bar',
                data: {
                    labels: ['1º Trim', '2º Trim', '3º Trim', '4º Trim'],
                    datasets: [{
                        label: 'Dividendos (R$)',
                        data: [1850, 2100, 1950, 2450],
                        backgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            display: true,
                            color: '#333',
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                }
            });

            // Gráfico de composição da carteira com porcentagens
            const carteiraCtx = document.getElementById('carteiraChart').getContext('2d');
            window.carteiraChart = new Chart(carteiraCtx, {
                type: 'pie',
                data: {
                    labels: ['PETR4', 'VALE3', 'BBAS3', 'SLCE3', 'CPFE3', 'Outros'],
                    datasets: [{
                        data: [24, 19, 14, 11, 12, 20],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12',
                            '#9b59b6',
                            '#34495e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + '%';
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 12
                            }
                        }
                    }
                }
            });

            // Gráfico de retorno por período (Performance)
            const returnPeriodCtx = document.getElementById('returnPeriodChart').getContext('2d');
            window.returnPeriodChart = new Chart(returnPeriodCtx, {
                type: 'bar',
                data: {
                    labels: ['1M', '3M', '6M', '12M', '24M'],
                    datasets: [{
                        label: 'Retorno (%)',
                        data: [2.4, 5.7, 9.2, 18.7, 42.3],
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            display: true,
                            anchor: 'end',
                            align: 'top',
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: '#333',
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                }
            });

            // Gráfico de volatilidade (Performance)
            const volatilityCtx = document.getElementById('volatilityChart').getContext('2d');
            window.volatilityChart = new Chart(volatilityCtx, {
                type: 'radar',
                data: {
                    labels: ['Volatilidade', 'Risco Sistemático', 'Risco Não-Sistemático', 'Drawdown Máximo', 'Índice Sharpe'],
                    datasets: [{
                        label: 'Minha Carteira',
                        data: [75, 85, 60, 70, 90],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: '#3498db',
                        pointBackgroundColor: '#3498db'
                    }, {
                        label: 'Mercado',
                        data: [65, 95, 40, 80, 75],
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: '#2ecc71',
                        pointBackgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });

            // Gráfico de projeção de dividendos
            const projecaoDividendosCtx = document.getElementById('projecaoDividendosChart').getContext('2d');
            window.projecaoDividendosChart = new Chart(projecaoDividendosCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{
                        label: 'Dividendos Recebidos (R$)',
                        data: [920, 1050, 980, 1100, 1020, 1150, 1250, 1180, 1320, 1280, 1350, 1420],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Projeção de Dividendos Mensais'
                        }
                    }
                }
            });
        }

        // Função para obter dados de performance conforme o período
        function getPerformanceData(period) {
            if (period === '5y') {
                return {
                    labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
                    datasets: [{
                        label: 'Minha Carteira',
                        data: [0, 28, 65, 89, 112, 140],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'IBOV',
                        data: [0, 15, 42, 58, 75, 92],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'CDI',
                        data: [0, 12, 26, 41, 57, 74],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'IPCA',
                        data: [0, 8, 17, 26, 35, 45],
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                };
            } else {
                // Dados para 1 ano
                return {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{
                        label: 'Minha Carteira',
                        data: [0, 5, 8, 12, 10, 15, 20, 18, 25, 30, 32, 40],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'IBOV',
                        data: [0, 2, 1, -1, -2, 2, 7, 5, 8, 12, 15, 20],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'CDI',
                        data: [0, 1.5, 3, 4.5, 6, 7.5, 9, 10.5, 12, 13.5, 15, 16.5],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'IPCA',
                        data: [0, 1, 2.1, 3.2, 4, 4.8, 5.5, 6.1, 6.8, 7.4, 8, 8.6],
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                };
            }
        }

        // Função para atualizar o gráfico de performance
        function updatePerformanceChart(period) {
            if (window.performanceChart) {
                window.performanceChart.data = getPerformanceData(period);
                window.performanceChart.update();
            }
        }

        // Função para buscar cotações online
        async function buscarCotacaoOnline(ticket) {
            try {
                // Esta é uma API gratuita para cotações de ações brasileiras
                // Nota: APIs gratuitas podem ter limitações de uso
                const response = await fetch(`https://brapi.dev/api/quote/${ticket}?range=1d&interval=1d&fundamental=true`);
                const data = await response.json();
                
                if (data && data.results && data.results.length > 0) {
                    return data.results[0].regularMarketPrice;
                } else {
                    throw new Error('Cotação não encontrada');
                }
            } catch (error) {
                console.error(`Erro ao buscar cotação online para ${ticket}:`, error);
                
                // Fallback para valores simulados caso a API não funcione
                const cotacoesSimuladas = {
                    'PETR4': 32.67,
                    'VALE3': 68.91,
                    'SLCE3': 45.20,
                    'BBAS3': 35.40,
                    'CPFE3': 32.15,
                    'CPLE6': 7.23,
                    'CMIG4': 10.85,
                    'CSMG3': 6.72,
                    'TAEE11': 36.40,
                    'CXSE3': 10.21,
                    'PSSA3': 45.80,
                    'GOAU4': 10.55,
                    'LEVE3': 6.30,
                    'EMBR3': 16.75,
                    'DIRR3': 3.45,
                    'WEGE3': 36.82,
                    'FRAS3': 7.10,
                    'MRFG3': 12.40
                };
                
                return cotacoesSimuladas[ticket] || (Math.random() * 100).toFixed(2);
            }
        }

        // Função para buscar cotações
        async function buscarCotacoes() {
            const elementosCotacao = document.querySelectorAll('.cotacao-atual');
            
            for (const elemento of elementosCotacao) {
                const ticket = elemento.getAttribute('data-ticket');
                
                try {
                    elemento.innerHTML = '<span class="loading-cotacao">Carregando...</span>';
                    
                    // Buscar cotação online
                    const cotacao = await buscarCotacaoOnline(ticket);
                    elemento.innerHTML = `R$ ${cotacao.toFixed(2)}`;
                    
                    // Atualizar valor atual e resultado
                    atualizarValoresAtivo(elemento.closest('tr'));
                } catch (error) {
                    elemento.innerHTML = '<span class="text-danger">Erro</span>';
                    console.error(`Erro ao buscar cotação para ${ticket}:`, error);
                }
            }
        }

        // Função para atualizar valores do ativo
        function atualizarValoresAtivo(linha) {
            const quantidade = parseInt(linha.getAttribute('data-quantidade'));
            const ticket = linha.getAttribute('data-ativo');
            
            // Encontrar a cotação atual
            const cotacaoElemento = linha.querySelector('.cotacao-atual');
            let cotacaoAtual = 0;
            
            if (cotacaoElemento && !cotacaoElemento.textContent.includes('Erro') && !cotacaoElemento.textContent.includes('Carregando')) {
                cotacaoAtual = parseFloat(cotacaoElemento.textContent.replace('R$ ', '').replace(',', '.'));
            }
            
            // Calcular valores
            const valorInvestido = parseFloat(linha.querySelector('td:nth-child(5)').textContent
                .replace('R$ ', '').replace('.', '').replace(',', '.'));
            const valorAtual = quantidade * cotacaoAtual;
            const resultado = valorAtual - valorInvestido;
            const percentualResultado = (resultado / valorInvestido) * 100;
            
            // Atualizar células
            linha.querySelector('td:nth-child(6)').textContent = `R$ ${valorAtual.toFixed(2).replace('.', ',')}`;
            
            const cellResultado = linha.querySelector('td:nth-child(9)');
            cellResultado.textContent = `${percentualResultado >= 0 ? '+' : ''}${percentualResultado.toFixed(2)}%`;
            cellResultado.className = percentualResultado >= 0 ? 'positive-return' : 'negative-return';
            
            // Atualizar totais da carteira
            atualizarTotaisCarteira();
        }

        // Função para atualizar totais da carteira
        function atualizarTotaisCarteira() {
            let totalInvestido = 0;
            let totalAtual = 0;
            
            document.querySelectorAll('#tabela-ativos tbody tr').forEach(linha => {
                if (linha.classList.contains('ativo-item')) {
                    const valorInvestido = parseFloat(linha.querySelector('td:nth-child(5)').textContent
                        .replace('R$ ', '').replace('.', '').replace(',', '.'));
                    const valorAtual = parseFloat(linha.querySelector('td:nth-child(6)').textContent
                        .replace('R$ ', '').replace('.', '').replace(',', '.'));
                    
                    totalInvestido += valorInvestido;
                    totalAtual += valorAtual;
                }
            });
            
            const resultado = totalAtual - totalInvestido;
            const percentualResultado = (resultado / totalInvestido) * 100;
            
            document.getElementById('total-investido').textContent = totalInvestido.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            document.getElementById('valor-atual').textContent = totalAtual.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            const elementoResultado = document.getElementById('lucro-prejuizo');
            elementoResultado.textContent = `${resultado >= 0 ? '+' : ''}R$ ${Math.abs(resultado).toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })} (${percentualResultado >= 0 ? '+' : ''}${percentualResultado.toFixed(2)}%)`;
            
            elementoResultado.className = resultado >= 0 ? 'positive-return' : 'negative-return';
            
            // Atualizar percentuais de cada ativo
            document.querySelectorAll('#tabela-ativos tbody tr').forEach(linha => {
                if (linha.classList.contains('ativo-item')) {
                    const valorAtual = parseFloat(linha.querySelector('td:nth-child(6)').textContent
                        .replace('R$ ', '').replace('.', '').replace(',', '.'));
                    const percentualCarteira = (valorAtual / totalAtual) * 100;
                    linha.querySelector('td:nth-child(7)').textContent = `${percentualCarteira.toFixed(2)}%`;
                }
            });
        }

        // Função para configurar eventos de edição
        function configurarEventosEdicao() {
            // Evento para botão editar
            document.querySelectorAll('.btn-editar').forEach(btn => {
                btn.addEventListener('click', function() {
                    const linha = this.closest('tr');
                    entrarModoEdicao(linha);
                });
            });
            
            // Evento para botão salvar
            document.querySelectorAll('.btn-salvar').forEach(btn => {
                btn.addEventListener('click', function() {
                    const linha = this.closest('tr');
                    salvarEdicao(linha);
                });
            });
            
            // Evento para botão cancelar
            document.querySelectorAll('.btn-cancelar').forEach(btn => {
                btn.addEventListener('click', function() {
                    const linha = this.closest('tr');
                    cancelarEdicao(linha);
                });
            });
            
            // Evento para botão excluir
            document.querySelectorAll('.btn-excluir').forEach(btn => {
                btn.addEventListener('click', function() {
                    const linha = this.closest('tr');
                    excluirAtivo(linha);
                });
            });
        }

        // Função para entrar no modo de edição
        function entrarModoEdicao(linha) {
            // Esconder elementos de visualização, mostrar elementos de edição
            linha.querySelectorAll('.view-mode').forEach(el => el.style.display = 'none');
            linha.querySelectorAll('.edit-mode').forEach(el => el.style.display = '');
            
            // Especificar para inputs
            linha.querySelectorAll('input.edit-mode').forEach(input => input.style.display = 'block');
        }

        // Função para salvar edição
        function salvarEdicao(linha) {
            // Obter novos valores
            const novoAtivo = linha.querySelector('td:nth-child(2) input').value;
            const novaQuantidade = parseInt(linha.querySelector('td:nth-child(3) input').value);
            
            // Atualizar valores na linha
            linha.setAttribute('data-ativo', novoAtivo);
            linha.setAttribute('data-quantidade', novaQuantidade);
            
            // Atualizar elementos de visualização
            linha.querySelector('td:nth-child(2) .view-mode').textContent = novoAtivo;
            linha.querySelector('td:nth-child(3) .view-mode').textContent = novaQuantidade.toLocaleString('pt-BR');
            
            // Atualizar cotação com novo ticket
            const elementoCotacao = linha.querySelector('.cotacao-atual');
            elementoCotacao.setAttribute('data-ticket', novoAtivo);
            elementoCotacao.innerHTML = '<span class="loading-cotacao">Carregando...</span>';
            
            // Sair do modo de edição
            sairModoEdicao(linha);
            
            // Buscar nova cotação
            setTimeout(() => {
                buscarCotacaoOnline(novoAtivo).then((cotacao) => {
                    elementoCotacao.innerHTML = `R$ ${cotacao.toFixed(2)}`;
                    atualizarValoresAtivo(linha);
                }).catch(() => {
                    elementoCotacao.innerHTML = '<span class="text-danger">Erro</span>';
                });
            }, 500);
        }

        // Função para buscar cotação individual
        async function buscarCotacaoIndividual(ticket, elemento) {
            try {
                const cotacao = await buscarCotacaoOnline(ticket);
                elemento.innerHTML = `R$ ${cotacao.toFixed(2)}`;
                return cotacao;
            } catch (error) {
                elemento.innerHTML = '<span class="text-danger">Erro</span>';
                console.error(`Erro ao buscar cotação para ${ticket}:`, error);
                return '0.00';
            }
        }

        // Função para cancelar edição
        function cancelarEdicao(linha) {
            // Restaurar valores originais nos inputs
            const ativoOriginal = linha.getAttribute('data-ativo');
            const quantidadeOriginal = linha.getAttribute('data-quantidade');
            
            linha.querySelector('td:nth-child(2) input').value = ativoOriginal;
            linha.querySelector('td:nth-child(3) input').value = quantidadeOriginal;
            
            // Sair do modo de edição
            sairModoEdicao(linha);
        }

        // Função para sair do modo de edição
        function sairModoEdicao(linha) {
            // Esconder elementos de edição, mostrar elementos de visualização
            linha.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'none');
            linha.querySelectorAll('.view-mode').forEach(el => el.style.display = '');
        }

        // Função para excluir ativo
        function excluirAtivo(linha) {
            if (confirm('Tem certeza que deseja excluir este ativo da carteira?')) {
                linha.remove();
                atualizarTotaisCarteira();
            }
        }

        // Função para adicionar novo ativo
        function adicionarNovoAtivo() {
            const tbody = document.querySelector('#tabela-ativos tbody');
            const novaLinha = document.createElement('tr');
            novaLinha.classList.add('ativo-item');
            
            // Dados padrão para novo ativo
            const novoAtivo = 'PETR4';
            const novaQuantidade = 100;
            const precoMedio = 30.00;
            const valorInvestido = novaQuantidade * precoMedio;
            
            novaLinha.setAttribute('data-ativo', novoAtivo);
            novaLinha.setAttribute('data-quantidade', novaQuantidade);
            
            novaLinha.innerHTML = `
                <td><i class="bi bi-grip-vertical"></i></td>
                <td class="editable-cell">
                    <span class="view-mode">${novoAtivo}</span>
                    <input type="text" class="edit-mode form-control form-control-sm" value="${novoAtivo}" style="display: none;">
                </td>
                <td class="editable-cell">
                    <span class="view-mode">${novaQuantidade}</span>
                    <input type="number" class="edit-mode form-control form-control-sm" value="${novaQuantidade}" style="display: none;">
                </td>
                <td class="cotacao-atual" data-ticket="${novoAtivo}">Carregando...</td>
                <td>R$ ${valorInvestido.toFixed(2).replace('.', ',')}</td>
                <td>R$ 0,00</td>
                <td>0,0%</td>
                <td class="positive-return">+0,0%</td>
                <td class="negative-return">-100,0%</td>
                <td>
                    <div class="btn-group btn-group-sm view-mode">
                        <button class="btn btn-outline-primary btn-editar">Editar</button>
                        <button class="btn btn-outline-danger btn-excluir">Excluir</button>
                    </div>
                    <div class="btn-group btn-group-sm edit-mode" style="display: none;">
                        <button class="btn btn-outline-success btn-salvar">Salvar</button>
                        <button class="btn btn-outline-secondary btn-cancelar">Cancelar</button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(novaLinha);
            
            // Configurar eventos para os novos botões
            novaLinha.querySelector('.btn-editar').addEventListener('click', function() {
                entrarModoEdicao(novaLinha);
            });
            
            novaLinha.querySelector('.btn-salvar').addEventListener('click', function() {
                salvarEdicao(novaLinha);
            });
            
            novaLinha.querySelector('.btn-cancelar').addEventListener('click', function() {
                cancelarEdicao(novaLinha);
            });
            
            novaLinha.querySelector('.btn-excluir').addEventListener('click', function() {
                excluirAtivo(novaLinha);
            });
            
            // Buscar cotação para o novo ativo
            setTimeout(() => {
                buscarCotacaoOnline(novoAtivo).then((cotacao) => {
                    novaLinha.querySelector('.cotacao-atual').innerHTML = `R$ ${cotacao.toFixed(2)}`;
                    atualizarValoresAtivo(novaLinha);
                }).catch(() => {
                    novaLinha.querySelector('.cotacao-atual').innerHTML = '<span class="text-danger">Erro</span>';
                });
            }, 500);
        }

        // Função para alternar modo de reordenar
        function toggleModoReordenar() {
            const btn = document.getElementById('btn-reordenar');
            const ativoItens = document.querySelectorAll('.ativo-item');
            
            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="bi bi-arrow-down-up"></i> Reordenar';
                
                ativoItens.forEach(item => {
                    item.style.cursor = 'pointer';
                    item.draggable = false;
                });
                
                // Remover event listeners de drag and drop
            } else {
                btn.classList.add('active');
                btn.innerHTML = '<i class="bi bi-check"></i> Concluir Reordenamento';
                
                ativoItens.forEach(item => {
                    item.style.cursor = 'move';
                    item.draggable = true;
                });
                
                // Adicionar event listeners de drag and drop
                configurarDragAndDrop();
            }
        }

        // Função para configurar drag and drop
        function configurarDragAndDrop() {
            const tbody = document.querySelector('#tabela-ativos tbody');
            let draggedItem = null;
            
            document.querySelectorAll('.ativo-item').forEach(item => {
                item.addEventListener('dragstart', function() {
                    draggedItem = this;
                    setTimeout(() => this.style.opacity = '0.5', 0);
                });
                
                item.addEventListener('dragend', function() {
                    draggedItem = null;
                    this.style.opacity = '1';
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '#f8f9fa';
                });
                
                item.addEventListener('dragleave', function() {
                    this.style.backgroundColor = '';
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    if (draggedItem !== this) {
                        if (draggedItem.nextSibling === this) {
                            tbody.insertBefore(draggedItem, this);
                        } else {
                            tbody.insertBefore(this, draggedItem);
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>